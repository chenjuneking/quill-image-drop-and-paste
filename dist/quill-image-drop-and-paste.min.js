var QuillImageDropAndPaste=function(e){"use strict";var t={generateFilename:()=>btoa(String(1e6*Math.random())+String(+new Date)).replace("=",""),urlIsImage(e,t=3e3){return this.validURL(e)?/\.(jpeg|jpg|gif|png|webp|tiff|bmp)$/.test(e)?Promise.resolve(!0):new Promise(((a,i)=>{let r;const n=new Image;n.onerror=n.onabort=()=>{clearTimeout(r),i(!1)},n.onload=()=>{clearTimeout(r),a(!0)},r=setTimeout((()=>{n.src="//!/an/invalid.jpg",i(!1)}),t),n.src=e})):Promise.reject(!1)},urlIsImageDataUrl:e=>/^data:image\/\w+;base64,/.test(e),validURL(e){try{return Boolean(new URL(e))}catch(e){return!1}},isRichText(e){let t=!1,a=!1;return Array.prototype.forEach.call(e,(e=>{"string"===e.kind&&e.type.match(/^text\/html$/i)&&(t=!0),"file"===e.kind&&e.type.match(/^image\/\w+$/i)&&(a=!0)})),t&&!a},resolveDataUrl(e,t){let a="";return"string"==typeof e?a=e:e instanceof ArrayBuffer&&(a=this.arrayBufferToBase64Url(e,t)),a},binaryStringToArrayBuffer(e){const t=e.length,a=new ArrayBuffer(t),i=new Uint8Array(a);let r=-1;for(;++r<t;)i[r]=e.charCodeAt(r);return a},arrayBufferToBase64Url:(e,t)=>`data:${t};base64,`+btoa(new Uint8Array(e).reduce(((e,t)=>e+String.fromCharCode(t)),"")),copyText(e,t=document.body){const a=document.createElement("textarea"),i=document.activeElement;a.value=e,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",a.style.fontSize="12pt";const r=document.getSelection();let n=!1;r&&r.rangeCount>0&&(n=r.getRangeAt(0)),t.append(a),a.select(),a.selectionStart=0,a.selectionEnd=e.length;let s=!1;try{s=document.execCommand("copy")}catch(e){}return a.remove(),r&&n&&(r.removeAllRanges(),r.addRange(n)),i&&i.focus(),s},isType:(e,t)=>Object.prototype.toString.call(e)===`[object ${t}]`};class a{constructor(e,t,a){this.dataUrl=e,this.type=t,this.name=a||""}}class i extends a{constructor(e,a,i){super(e,a,i),this.dataUrl=e,this.type=a,this.name=i||`${t.generateFilename()}.${this.getSuffix()}`}minify(e){return new Promise(((a,r)=>{const n=e.maxWidth||800,s=e.maxHeight||800,o=e.quality||.8;if(!this.dataUrl)return r({message:"[error] QuillImageDropAndPaste: Fail to minify the image, dataUrl should not be empty."});const l=new Image;l.onload=()=>{const e=l.width,t=l.height;e>t?e>n&&(l.height=t*n/e,l.width=n):t>s&&(l.width=e*s/t,l.height=s);const d=document.createElement("canvas");d.width=l.width,d.height=l.height;const h=d.getContext("2d");if(h){h.drawImage(l,0,0,l.width,l.height);const e=this.type||"image/png",t=d.toDataURL(e,o);a(new i(t,e,this.name))}else r({message:"[error] QuillImageDropAndPaste: Fail to minify the image, create canvas context failure."})},l.src=t.resolveDataUrl(this.dataUrl,this.type)}))}toFile(e){return e=e||this.name,window.File?new File([this.toBlob()],e,{type:this.type}):(console.error("[error] QuillImageDropAndPaste: Your browser didnot support File API."),null)}toBlob(){const e=t.resolveDataUrl(this.dataUrl,this.type).replace(/^[^,]+,/,""),a=t.binaryStringToArrayBuffer(atob(e));return this.createBlob([a],{type:this.type})}createBlob(e,t){t||(t={}),"string"==typeof t&&(t={type:t});try{return new Blob(e,t)}catch(a){if("TypeError"!==a.name)throw a;const i=new("BlobBuilder"in window?window.BlobBuilder:"MSBlobBuilder"in window?window.MSBlobBuilder:"MozBlobBuilder"in window?window.MozBlobBuilder:window.WebKitBlobBuilder);for(let t=0;t<e.length;t++)i.append(e[t]);return i.getBlob(t.type)}}getSuffix(){const e=this.type.match(/^image\/(\w+)$/);return e?e[1]:"png"}}class r{constructor(e,t){this.quill=e,this.option=t}}class n extends r{constructor(e,t){super(e,t),"boolean"!=typeof t.autoConvert&&(t.autoConvert=!0),this.quill=e,this.option=t,this.handleDrop=this.handleDrop.bind(this),this.handlePaste=this.handlePaste.bind(this),this.insert=this.insert.bind(this),this.quill.root.addEventListener("drop",this.handleDrop,!1),this.quill.root.addEventListener("paste",this.handlePaste,!1)}handleDrop(e){if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length){if(e.preventDefault(),document.caretRangeFromPoint){const t=document.getSelection(),a=document.caretRangeFromPoint(e.clientX,e.clientY);t&&a&&t.setBaseAndExtent(a.startContainer,a.startOffset,a.startContainer,a.startOffset)}this.readFiles(e.dataTransfer.files,((e,a="image/png",r)=>{"function"==typeof this.option.handler?this.option.handler.call(this,e,a,new i(e,a,r)):this.insert.call(this,t.resolveDataUrl(e,a),a)}),e)}}handlePaste(e){if(e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length){if(t.isRichText(e.clipboardData.items))return;this.readFiles(e.clipboardData.items,((e,a="image/png")=>{"function"==typeof this.option.handler?this.option.handler.call(this,e,a,new i(e,a)):this.insert(t.resolveDataUrl(e,a),"image")}),e)}}readFiles(e,a,i){Array.prototype.forEach.call(e,(e=>{t.isType(e,"DataTransferItem")?this.handleDataTransfer(e,a,i):e instanceof File&&this.handleDroppedFile(e,a,i)}))}handleDataTransfer(e,a,i){const r=this,{type:n}=e;if(n.match(/^image\/(gif|jpe?g|a?png|svg|webp|bmp)/i)){i.preventDefault();const t=new FileReader;t.onload=e=>{e.target&&e.target.result&&a(e.target.result,n)};const r=e.getAsFile?e.getAsFile():e;r instanceof Blob&&t.readAsDataURL(r)}else n.match(/^text\/plain$/i)&&e.getAsString((e=>{const i=this.getIndex();if(t.urlIsImageDataUrl(e)){const t=e.match(/^data:(image\/\w+);base64,/),r=t?t[1]:"image/png";a(e,r),this.quill.deleteText(i,e.length,"user"),this.quill.setSelection(i)}else this.option.autoConvert&&t.urlIsImage(e).then((()=>{setTimeout((()=>{this.quill.deleteText(i,e.length,"user"),r.insert(e,"image",i)}))})).catch((()=>{}))}))}handleDroppedFile(e,t,a){const{type:i,name:r=""}=e;if(i.match(/^image\/(gif|jpe?g|a?png|svg|webp|bmp)/i)){a.preventDefault();const n=new FileReader;n.onload=e=>{e.target&&e.target.result&&t(e.target.result,i,r)},n.readAsDataURL(e)}}insert(e,t,a){let i;a=void 0===a?this.getIndex():a,"image"===t?(i=a+1,this.quill.insertEmbed(a,t,e,"user")):"text"===t&&(i=a+e.length,this.quill.insertText(a,e,"user")),setTimeout((()=>{this.quill.setSelection(i)}))}getIndex(){let e=(this.quill.getSelection(!0)||{}).index;return(void 0===e||e<0)&&(e=this.quill.getLength()),e}}return n.ImageData=i,window.QuillImageDropAndPaste=n,"Quill"in window&&window.Quill.register("modules/imageDropAndPaste",n),e.ImageData=i,e.default=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=quill-image-drop-and-paste.min.js.map
